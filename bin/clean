#!/usr/bin/env bash
##############################
## ES-Ubuntu                ##
##                          ##
## clean                    ##
##                          ##
## Remove unneeded packages ##
## Remove old snaps         ##
## Delete caches            ##
##############################

# Strict mode
set -euo pipefail
IFS=$'\n\t'

if [[ $(id -u) -ne 0 ]]; then
    echo "Run as root!"
    exit 1
fi

# apt
apt-get autoremove --purge --yes
apt-get clean --yes

# snap
snaps=$(snap list --all | awk '/disabled/{print $1, $3}')
for line in ${snaps}; do
    IFS=$' \t' read -r snapname revision <<< "${line}"
    snap remove "${snapname}" --revision="${revision}"
done

# cache
rm -rf /var/cache/*
rm -rf /var/lib/snapd/cache/*

exit 0
