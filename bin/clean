#!/usr/bin/env bash
##############################
## ES-Ubuntu                ##
##                          ##
## clean                    ##
##                          ##
## Remove unneeded packages ##
## Remove old snaps         ##
## Delete caches            ##
##############################

# Strict mode minus IFS
set -euo pipefail

if [[ $(id -u) -ne 0 ]]; then
    echo "Run as root!"
    exit 1
fi

# apt
apt-get autoremove --purge --yes
apt-get clean --yes

# snap
while read -r snapname revision; do
    snap remove "$snapname" --revision="$revision"
done < <(snap list --all | awk '/disabled/{print $1, $3}')

# cache
rm -rf /var/cache/*
rm -rf /var/lib/snapd/cache/*

exit 0
